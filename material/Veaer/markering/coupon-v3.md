# 优惠券服务

## 前言

进入正题，营销体系的基础服务「优惠券服务」。通过如下问题来介绍优惠券：

- 优惠券有**哪些类型**？
- 优惠券有**哪些适用范围**？
- 优惠券有**哪些常见的场景**？
- 优惠券本身应该有**哪些状态**?
- 优惠券服务要有**哪些服务能力**？
- 优惠券服务的**风控**怎么做？

## 优惠券有哪些类型？

对于获取优惠券的用户而言，关注的是优惠券的优惠能力，所以按优惠能力维度优惠券主要分为下面三类：

优惠能力维度|描述
------------|------------
满减券|满多少金额(不含邮费)可以减多少金额
现金券|抵扣多少现金(无门槛)
抵扣券|抵扣某Sku全部金额(一个数量)
折扣券|打折

对于发放优惠券的运营人员而言：

一种是「**固定有效期**」，优惠券的生效时间戳和过期时间戳，在创建优惠券的时候已经确定。用户在任意时间领取该券，该券的有效时间都是之前设置的有效时间的开始结束时间。

另一种是「**动态有效期**」，创建优惠券设置的是有效时间段，比如7天有效时间、12小时有效时间等。这类优惠券以用户领取优惠券的时间为优惠券的有效时间的开始时间，以以用户领取优惠券的时间+有效时间为有效时间的结束时间。

有效期维度|优惠券类型|优惠券生效时间|优惠券失效时间|描述
------------|------------|------------|------------|------------
固定|固定有效期|优惠券类型被创建时已确定|优惠券类型被创建时已确定|无论用户什么时间领取该优惠券，优惠券生效的时间都是设置好的统一时间
动态|动态有效期|用户领取优惠券时，当前时间戳|用户领取优惠券时，当前时间戳 + N\*24\*60\*60|优惠券类型被创建时，只确定了该优惠券的有效，例如6小时、7天、一个月

小结如下：

<p align="center">
    <a href="http://cdn.veaer.com/coupon-type.png" target="_blank">
        <img src="http://cdn.veaer.com/coupon-type.png" width="100%">
    </a>
</p>


## 优惠券有哪些适用范围？

### 运营策略

限制纬度|限制细节|描述
------------|------------|------------
商品纬度||
|(非)指定Sku|Sku券
|(非)指定Spu|Spu券
|(非)指定类别|类别券
平台纬度||
|指定店铺|店铺券
|全场通用|平台券

### 适用终端

适用终端(复选框)|描述
------------|------------
Android|安卓端
iOS|iOS端
PC|网页电脑端
Mobile|网页手机端
Wechat|微信端
微信小程序|微信小程序
All|以上所有

### 支付方式

支付类型|描述
------------|------------
货到付款|
在线支付|支付宝/微信/银联
All|

### 适用人群

适用人群|描述
------------|------------
白名单|测试用户
会员|会员专属

小结如下：

<p align="center">
    <a href="http://cdn.veaer.com/coupon-scope.jpg" target="_blank">
        <img src="http://cdn.veaer.com/coupon-scope.jpg" width="80%">
    </a>
</p>




## 优惠券有哪些常见的场景？

### 领取优惠券场景

领取优惠券场景|描述
------------|------------
活动页面|大促、节假日活动页面展示获取优惠券的按钮
游戏页面|通过游戏获取优惠券
店铺首页|店铺首页展示领券入口
商品详情|商品详情页面展示领券入口
积分中心|积分兑换优惠券

### 展示优惠券场景

展示优惠券场景|描述
------------|------------
活动页面|大促、节假日活动页面展示可以领取的优惠券
商品详情|商品详情页面展示可以领取、可以使用的优惠券列表
个人中心-我的优惠券|我的优惠券列表
订单结算页面|结算页面，适用该订单的优惠券列表以及推荐
积分中心|展示可以兑换的优惠券详情


### 选择优惠券场景

选择优惠券场景|描述
------------|------------
商品详情|商品详情页面展示该用户已有的，且适用于该商品的优惠券
订单结算页面-优惠券列表|选择可用优惠券结算
订单结算页面-输入优惠码|输入优惠码结算

### 返还优惠券场景

返还优惠券场景|描述
------------|------------
未支付订单取消|未支付的订单，用户主动取消返还优惠券，或超时关单返还优惠券
已支付订单全款取消|已支付(未收货)的订单，订单部分退款不返还，当整个订单全部退款返还优惠券

### 优惠券获取场景示例

场景示例|描述
------------|------------
活动页领券|大促、节假日活动页面展示获取优惠券的按钮
游戏发券|游戏奖励
商品页领券|-
店铺页领券|-
购物返券|购买某个Sku，订单妥投后发放优惠券
新用户发券|新用户注册发放优惠券
积分兑券|积分换取优惠券
评论返券|用户订单收货之后，添加评论(审核后)，给用户返回一张指定优惠券

小结如下：

<p align="center">
    <a href="http://cdn.veaer.com/coupon-scene.jpg" target="_blank">
        <img src="http://cdn.veaer.com/coupon-scene.jpg" width="80%">
    </a>
</p>


## 优惠券本身应该有哪些状态？

<p align="center">
    <a href="http://cdn.veaer.com/coupon-status.jpg" target="_blank">
        <img src="http://cdn.veaer.com/coupon-status.jpg" width="60%">
    </a>
</p>


## 优惠券服务要有哪些服务能力？

### 服务能力1: 发放优惠券

发放方式|描述
------------|------------
同步发放|适用于用户点击领券等实时性要求较高的获取券场景
异步发放|适用于实时性要求不高的发放券场景，比如新用户注册发券等场景

发放能力|描述
------------|------------
单张发放|指定一个优惠券类型ID，且指定一个UID只发一张该券
批量发放|指定一个优惠券类型ID，且指定一批UID，每个UID只发一张该券

发放类型|描述
------------|------------
优惠券类型标识|通过该优惠券类型的身份标识发放，比如创建一个优惠券类型时会生成一个16位标识码，用户通过`16位标识码`领取优惠券；这里不使用自增ID(避免对外泄露历史创建了的优惠券数量)
优惠码code|创建一个优惠券类型时，运营人员会给该券填写一个6位左右的Ascall码，比如`SKR6a6`，用户通过该码领取优惠券

### 服务能力2: 后台撤销优惠券

撤销能力|描述
------------|------------
单张撤销|指定一个优惠券ID，且指定一个UID，校验归属是否合法，之后撤销一张券
批量撤销|指定一个优惠券类型ID，且指定一批UID，每个UID撤销一张该券

### 服务能力3: 伴随订单系统进行状态变更

| 变更类型 | 描述                                 |
| -------- | ------------------------------------ |
| 冻结     | 成单时对优惠券进行订单绑定占用       |
| 解冻     | 用户未支付前取消订单，解冻归还优惠券 |
| 核销     | 将已经冻结的优惠券标记为已使用       |

| 变更能力           | 描述                                                 |
| ------------------ | ---------------------------------------------------- |
| 单张冻结/解冻/核销 | 指定一个优惠券ID，一个订单 ID，更改优惠券状态        |
| 批量冻结/解冻/核销 | 指定一个优惠券ID与订单 ID 的映射，进行优惠券状态变更 |

### 服务能力4: 列表查询优惠券

用户优惠券列表|子类|描述
------------|------------|------------
全部|-|查询该用户所有的优惠券
可以使用|全部|查询该用户所有可以使用的优惠券
-|适用于某个spu或sku|查询该用户适用于某个spu或sku可以使用的优惠券
-|适用于某个类别|查询该用户适用于某个类别可以使用的优惠券
-|适用于某个店铺|查询该用户适用于某个店铺可以使用的优惠券
已用|全部|查询该用户所有已经使用的优惠券
-|正常使用|查询该用户所有履约完成的订单中使用的优惠券
-|订单冻结|查询该用户所有未关闭订单中被冻结的优惠券
无效|全部|查询该用户拥有，但是不可用的优惠券
-|过期|查询该用户所有过期的优惠券
-|失效|查询该用户所有后台冻结的优惠券

### 服务能力5: 条件查询优惠券

有两种场景的条件查询

1. 商品/店铺展示页面可以展示此商品/店铺 已经领取/可以领取的券的集合
2. 下单时根据商品/店铺/支付方式过滤出当前可用的优惠券集合

注：活动页券集合一般会搭配相应的运营系统自定义，不在此列

### 服务能力6: 结算页优惠券推荐

订单结算页面推荐一张最适合(金额)该订单的优惠券

小结如下：

<p align="center">
    <a href="http://cdn.veaer.com/coupon-serve.jpg" target="_blank">
        <img src="http://cdn.veaer.com/coupon-serve.jpg" width="100%">
    </a>
</p>


## 优惠券服务的风控怎么做？

一旦有发生风险的可能则触发风控：

- 对用户，提示稍后再试或联系客服 
- 对内部，报警提示，核查校验报警是否存在问题 

### 频率限制

领取|描述
------------|------------
设备ID|每天领取某优惠券的个数限制
UID|每天领取某优惠券的个数限制
IP|每天领取某优惠券的个数限制

使用|描述
------------|------------
设备ID|每天使用某优惠券的个数限制
UID|每天使用某优惠券的个数限制
IP|每天使用某优惠券的个数限制
手机号|每天使用某优惠券的个数限制
邮编|比如注重邮编的海外地区，每天使用某优惠券的个数限制

### 用户风险等级

依托用户历史订单数据，得到用户成功完成交易(比如成功妥投15天+)的比率，根据此比率对用户进行等级划分，高等级进入通行Unblock名单，低等级进入Block名单，根据不同用户级别设置限制策略。等其他大数据分析手段。

### 阈值

- 发券预算
- 实际使用券预算

根据预算值设置发券总数阈值，当触发阈值时阻断并报警。

### 优惠券不要支持虚拟商品

优惠券尽量不要支持虚拟商品以防止可能被利用的不法活动。

<p align="center">
    <a href="http://cdn.veaer.com/coupon-control.png" target="_blank">
        <img src="http://cdn.veaer.com/coupon-control.png" width="80%">
    </a>
</p>

